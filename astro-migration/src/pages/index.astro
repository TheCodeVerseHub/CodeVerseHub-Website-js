---
export const prerender = false;
import Layout from '../layouts/Layout.astro';
import { db } from '../db';
import { announcements } from '../db/schema';
import { desc, eq } from 'drizzle-orm';
import '../styles/hero-redesign.css';
import '../styles/testimonials-modern.css';
import '../styles/contact-modern-v2.css';
import '../styles/cta-modern.css';
import '../styles/sections-modern.css';

const announcementsData = await db.select().from(announcements).where(eq(announcements.isActive, true)).orderBy(desc(announcements.createdAt)).limit(3);
const activeAnnouncements = announcementsData;
const discordStats = { members: 720, channels: 50, bots: 5 };
---

<Layout title="The Codeverse Hub - Discord Programming Community">
<!-- Hero Section (Redesigned) -->
<section class="hero-wrapper">
  <div class="hero-grid-bg"></div>
  <div class="hero-glow-orb orb-1"></div>
  <div class="hero-glow-orb orb-2"></div>

  <div class="container mx-auto px-4 relative z-10">
    <div class="grid lg:grid-cols-2 gap-12 items-center min-h-[85vh] py-20">
      <!-- Text Content -->
      <div class="text-center lg:text-left relative">
        <div class="glass-pill animate-fade-in-up mx-auto lg:mx-0">
          <span class="w-2 h-2 rounded-full bg-cyan-400 animate-pulse"></span>
          Welcome to the Server!
        </div>
        
        <h1 class="hero-title text-white animate-fade-in-up delay-100">
          The Codeverse Hub<br/>
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500 text-2xl lg:text-4xl block mt-2">
            Where Developers Evolve
          </span>
        </h1>
        
        <p class="hero-desc animate-fade-in-up delay-200 mx-auto lg:mx-0">
          Learn faster, build smarter, stay motivated. A focused hub for coders who want feedback, resources, events & genuine collaboration.
        </p>
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start animate-fade-in-up delay-300">
          <a href="https://discord.gg/3xKFvKhuGR" class="hero-btn-primary group">
            <i class="fab fa-discord text-xl group-hover:rotate-12 transition-transform"></i>
            Join Discord
          </a>
          <a href="/resources" class="hero-btn-secondary">
            <i class="fas fa-book-open"></i>
            Explore Resources
          </a>
        </div>

        <div class="mt-12 flex items-center justify-center lg:justify-start gap-8 text-gray-400 animate-fade-in-up delay-400">
          <div class="text-center lg:text-left">
            <div class="text-2xl font-bold text-white">{discordStats.members}+</div>
            <div class="text-sm">Members</div>
          </div>
          <div class="w-px h-8 bg-white/10"></div>
          <div class="text-center lg:text-left">
            <div class="text-2xl font-bold text-white">{discordStats.channels}+</div>
            <div class="text-sm">Channels</div>
          </div>
          <div class="w-px h-8 bg-white/10"></div>
          <div class="text-center lg:text-left">
            <div class="text-2xl font-bold text-white">{discordStats.bots}+</div>
            <div class="text-sm">Bots</div>
          </div>
        </div>
      </div>

      <!-- Visual Content -->
      <div class="relative flex justify-center animate-fade-in delay-200">
        <div class="logo-container">
          <div class="logo-glow-ring"></div>
          <!-- User requested logo file -->
          <img src="/images/image.png" alt="CodeVerseHub Logo" class="main-logo" />
          
          <!-- Orbiting Icons -->
          <div class="orbit-item orbit-1" title="JavaScript">
            <i class="fab fa-js text-yellow-400"></i>
          </div>
          <div class="orbit-item orbit-2" title="Python">
            <i class="fab fa-python text-blue-400"></i>
          </div>
          <div class="orbit-item orbit-3" title="React">
            <i class="fab fa-react text-cyan-400"></i>
          </div>
          <div class="orbit-item orbit-4" title="Database">
            <i class="fas fa-database text-green-400"></i>
          </div>

          <!-- Floating Cards -->
          <div class="float-card float-1 hidden lg:flex">
            <div class="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center text-green-400">
              <i class="fas fa-check"></i>
            </div>
            <div>
              <div class="text-xs text-gray-400">Just now</div>
              <div class="text-sm font-medium text-white">Bug Fixed</div>
            </div>
          </div>

          <div class="float-card float-2 hidden lg:flex">
            <div class="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center text-purple-400">
              <i class="fas fa-trophy"></i>
            </div>
            <div>
              <div class="text-xs text-gray-400">Weekly Challenge</div>
              <div class="text-sm font-medium text-white">Winner Announced</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Discord Statistics -->
<section class="stats-modern-section">
    <div class="container">
        <div class="section-header-modern" style="margin-bottom: 3rem;">
            <span class="section-eyebrow">Live Statistics</span>
            <h2 class="section-title-modern">Our Growing <span class="gradient-text">Community</span></h2>
        </div>
    </div>
    <div class="stats-grid">
        <div class="stat-card-modern">
            <div class="stat-icon-wrapper">
                <i class="fas fa-users"></i>
            </div>
            <span class="stat-number-modern">{discordStats.members}+</span>
            <span class="stat-label-modern">Discord Members</span>
        </div>
        
        <div class="stat-card-modern">
            <div class="stat-icon-wrapper">
                <i class="fas fa-hashtag"></i>
            </div>
            <span class="stat-number-modern">{discordStats.channels}+</span>
            <span class="stat-label-modern">Active Channels</span>
        </div>
        
        <div class="stat-card-modern">
            <div class="stat-icon-wrapper">
                <i class="fas fa-robot"></i>
            </div>
            <span class="stat-number-modern">{discordStats.bots}+</span>
            <span class="stat-label-modern">Helpful Bots</span>
        </div>
    </div>
</section>

<!-- Discord Channels Showcase -->
<section class="channels-modern-section">
    <div class="container">
        <div class="section-header-modern">
            <h2 class="section-title-modern">Explore Our <span class="gradient-text">Discord Channels</span></h2>
            <p class="section-subtitle-modern">Join the conversation in our specialized channels</p>
        </div>
        
        <div class="channels-grid-modern">
            <div class="channel-category-card">
                <div class="category-header">
                    <div class="category-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h3 class="category-title">General Channels</h3>
                </div>
                <ul class="channel-list-modern">
                    <li class="channel-item-modern">
                        <span class="channel-hash">#</span>
                        <span class="channel-name">lobby</span>
                        <span class="channel-desc">General hangout & chat</span>
                    </li>
                    <li class="channel-item-modern">
                        <span class="channel-hash">#</span>
                        <span class="channel-name">dev-discussion</span>
                        <span class="channel-desc">Talk about tech & code</span>
                    </li>
                    <li class="channel-item-modern">
                        <span class="channel-hash">#</span>
                        <span class="channel-name">introductions</span>
                        <span class="channel-desc">Say hello to everyone</span>
                    </li>
                    <li class="channel-item-modern">
                        <span class="channel-hash">#</span>
                        <span class="channel-name">announcements</span>
                        <span class="channel-desc">Server news & updates</span>
                    </li>
                </ul>
            </div>

            <div class="channel-category-card">
                <div class="category-header">
                    <div class="category-icon">
                        <i class="fas fa-code"></i>
                    </div>
                    <h3 class="category-title">Programming Channels</h3>
                </div>
                <ul class="channel-list-modern">
                    <li class="channel-item-modern">
                        <span class="channel-hash">#</span>
                        <span class="channel-name">ask-for-help</span>
                        <span class="channel-desc">Get help with your code</span>
                    </li>
                    <li class="channel-item-modern">
                        <span class="channel-hash">#</span>
                        <span class="channel-name">projects-showcase</span>
                        <span class="channel-desc">Show off your work</span>
                    </li>
                    <li class="channel-item-modern">
                        <span class="channel-hash">#</span>
                        <span class="channel-name">resources</span>
                        <span class="channel-desc">Useful tools & links</span>
                    </li>
                    <li class="channel-item-modern">
                        <span class="channel-hash">#</span>
                        <span class="channel-name">events</span>
                        <span class="channel-desc">Community events</span>
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="text-center mt-12">
            <a href="/resources" class="btn-modern-primary" style="display: inline-flex; margin: 0 auto;">
                Explore Resources <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="features-modern-section">
    <div class="container">
        <div class="section-header-modern">
            <span class="section-eyebrow">Why Join Us?</span>
            <h2 class="section-title-modern">Server <span class="gradient-text">Features</span></h2>
            <p class="section-subtitle-modern">Everything you need to grow as a developer</p>
        </div>
        
        <div class="features-grid-modern">
            <div class="feature-card-modern">
                <div class="feature-icon-wrapper">
                    <i class="fas fa-comments"></i>
                </div>
                <h3 class="feature-title-modern">Active Community</h3>
                <p class="feature-desc-modern">Engage with a vibrant community of programmers, from beginners to experts, ready to help and collaborate on projects.</p>
            </div>
            
            <div class="feature-card-modern">
                <div class="feature-icon-wrapper">
                    <i class="fas fa-code"></i>
                </div>
                <h3 class="feature-title-modern">Code Help</h3>
                <p class="feature-desc-modern">Get assistance with your programming questions, code reviews, and debugging help from experienced members.</p>
            </div>
            
            <div class="feature-card-modern">
                <div class="feature-icon-wrapper">
                    <i class="fas fa-users"></i>
                </div>
                <h3 class="feature-title-modern">Fun Events</h3>
                <p class="feature-desc-modern">Participate in coding challenges, tech discussions, and community events to learn, compete, and have fun.</p>
            </div>
        </div>
    </div>
</section>

<!-- Recent Announcements -->
{activeAnnouncements.length > 0 && (
<section class="announcements-modern-section">
    <div class="container">
        <div class="section-header-modern">
            <span class="section-eyebrow">Latest News</span>
            <h2 class="section-title-modern">Recent <span class="gradient-text">Announcements</span></h2>
        </div>
        
        <div class="announcements-grid-modern">
            {activeAnnouncements.map(announcement => (
            <div class="announcement-card-modern">
                <div class="announcement-header">
                    <div class="announcement-icon-modern">
                        <i class="fas fa-bullhorn"></i>
                    </div>
                    <h3 class="announcement-title-modern">{announcement.title}</h3>
                </div>
                <p class="announcement-content-modern">{announcement.content.substring(0, 100)}...</p>
                <div class="announcement-footer-modern">
                    <div class="announcement-meta-item">
                        <i class="fas fa-user"></i>
                        <span>Admin</span>
                    </div>
                    <div class="announcement-meta-item">
                        <i class="fas fa-calendar"></i>
                        <span>{new Date(announcement.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</span>
                    </div>
                </div>
            </div>
            ))}
        </div>
    </div>
</section>
)}

<!-- Testimonials Section -->
<section class="testimonials-modern dark-bg">
    <div class="container">
        <div class="testimonials-header">
            <span class="testimonials-eyebrow">Community Voices</span>
            <h2 class="testimonials-title">What Our Members Say</h2>
        </div>
        <div class="testimonials-grid">
            <!-- Testimonial 1 -->
            <div class="testimonial-card-modern">
                <div class="quote-icon-modern">
                    <i class="fas fa-quote-left"></i>
                </div>
                <div class="rating-stars-modern">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <p class="testimonial-text-modern">"I've been on this server since July, and it's one of the best programming communities I've been part of. It is very active and friendly, and it also focuses on other things besides IT. Even if you're a complete beginner, this server is sure to welcome you and assist you if you are stuck or need help."</p>
                <div class="testimonial-footer">
                    <div class="testimonial-avatar">SP</div>
                    <div class="testimonial-author-info">
                        <span class="author-name">Stefi Prokop</span>
                        <span class="author-role">@hyscript7</span>
                    </div>
                </div>
            </div>
            
            <!-- Testimonial 2 -->
            <div class="testimonial-card-modern">
                <div class="quote-icon-modern">
                    <i class="fas fa-quote-left"></i>
                </div>
                <div class="rating-stars-modern">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <p class="testimonial-text-modern">"The CodeVerse Hub is a very welcoming community with helpful and experienced people willing to help you at any moment. Everyone is supportive of each other and is treated nicely. It also has fun activities on the side to help you take a small break from hard coding sessions."</p>
                <div class="testimonial-footer">
                    <div class="testimonial-avatar">MH</div>
                    <div class="testimonial-author-info">
                        <span class="author-name">MHIA</span>
                        <span class="author-role">@oyasumi_star09</span>
                    </div>
                </div>
            </div>
            
            <!-- Testimonial 3 -->
            <div class="testimonial-card-modern">
                <div class="quote-icon-modern">
                    <i class="fas fa-quote-left"></i>
                </div>
                <div class="rating-stars-modern">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <p class="testimonial-text-modern">"CodeVerse Hub is a welcoming, organized Discord community for programmers at every level. Supportive members and active channels make it a great place to learn, collaborate, and grow, with fun bots, coding challenges, and events to keep things engaging."</p>
                <div class="testimonial-footer">
                    <div class="testimonial-avatar">AV</div>
                    <div class="testimonial-author-info">
                        <span class="author-name">Aditya Verma</span>
                        <span class="author-role">Community Founder</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Section (Modern V2) -->
<section id="contact" class="contact-modern-v2 dark-bg">
    <div class="contact-header-v2">
        <span class="contact-eyebrow-center">Connect Us</span>
        <h2 class="contact-title-center">Let's Build Something Together</h2>
    </div>
    
    <div class="contact-container-v2">
        <!-- Left Side: Info -->
        <div class="contact-info-v2">
            <p class="contact-desc-v2">
                Have a question, suggestion, or just want to say hello? We'd love to hear from you. Join our community or drop us a message directly.
            </p>

            <div class="contact-details-v2">
                <div class="contact-detail-item">
                    <div class="detail-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="detail-content">
                        <span class="detail-label">Email Us</span>
                        <a href="mailto:thecodeversedev@gmail.com" class="detail-link">thecodeversedev@gmail.com</a>
                    </div>
                </div>
                <div class="contact-detail-item">
                    <div class="detail-icon">
                        <i class="fab fa-discord"></i>
                    </div>
                    <div class="detail-content">
                        <span class="detail-label">Join Discord</span>
                        <a href="https://discord.gg/3xKFvKhuGR" target="_blank" rel="noopener" class="detail-link">The CodeVerse Hub</a>
                    </div>
                </div>
            </div>
            
            <div class="contact-connect-v2">
                <span class="connect-label">Follow Our Socials</span>
                <div class="contact-social-v2">
                    <a href="https://discord.gg/3xKFvKhuGR" class="social-link-v2" aria-label="Discord" target="_blank" rel="noopener">
                        <i class="fab fa-discord"></i>
                    </a>
                    <a href="https://github.com/TheCodeVerseHub" class="social-link-v2" aria-label="GitHub" target="_blank" rel="noopener">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="https://www.instagram.com/thecodeversehub/" class="social-link-v2" aria-label="Instagram" target="_blank" rel="noopener">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="mailto:thecodeversedev@gmail.com" class="social-link-v2" aria-label="Email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Right Side: Form -->
        <div class="contact-form-wrapper-v2">
            <form action="https://formspree.io/f/mdkvwgln" method="POST" class="form-grid-v2">
                <div class="form-row">
                    <div class="form-group-v2">
                        <label for="name" class="form-label-v2">Name</label>
                        <input type="text" name="name" id="name" class="form-input-v2" placeholder="John Doe" required>
                    </div>
                    <div class="form-group-v2">
                        <label for="email" class="form-label-v2">Email</label>
                        <input type="email" name="email" id="email" class="form-input-v2" placeholder="john@example.com" required>
                    </div>
                </div>
                
                <div class="form-group-v2">
                    <label for="subject" class="form-label-v2">Subject</label>
                    <input type="text" name="subject" id="subject" class="form-input-v2" placeholder="What is this about?" required>
                </div>
                
                <div class="form-group-v2">
                    <label for="message" class="form-label-v2">Message</label>
                    <textarea name="message" id="message" class="form-textarea-v2" placeholder="Tell us what's on your mind..." required></textarea>
                </div>
                
                <button type="submit" class="submit-btn-v2">
                    <i class="fas fa-paper-plane"></i> Send Message
                </button>
            </form>
        </div>
    </div>
</section>

<!-- Call to Action (Modern) -->
<section class="cta-modern-section dark-bg">
    <div class="container">
        <div class="cta-modern-card">
            <span class="cta-eyebrow">Join The Community</span>
            <h2 class="cta-title-modern">Ready to <span class="cta-title-gradient">Level Up?</span></h2>
            <p class="cta-desc-modern">
                Real-time collaboration, project feedback, curated resources, weekly events, coding challenges and a supportive network of developers across the globe. Dive in and build something awesome with us.
            </p>
            <div class="cta-buttons-modern">
                <a href="https://discord.gg/3xKFvKhuGR" class="btn-modern-primary" aria-label="Join Discord Server">
                    <i class="fab fa-discord"></i> Join Server
                </a>
                <a href="https://github.com/TheCodeVerseHub" class="btn-modern-secondary" aria-label="Explore GitHub">
                    <i class="fab fa-github"></i> Explore GitHub
                </a>
            </div>
        </div>
    </div>
</section>

<script>
// Message character counter
const msgField = document.querySelector('#v2Message');
const counter = document.getElementById('cvhMessageCounter');
if (msgField && counter) {
    const warn = 900, danger = 1100, max = 1200;
    function update() {
        const len = msgField.value.length;
        counter.textContent = len + ' / ' + max + ' chars';
        counter.classList.remove('warning', 'danger');
        if (len > danger) counter.classList.add('danger');
        else if (len > warn) counter.classList.add('warning');
    }
    msgField.addEventListener('input', update);
    update();
}

// CTA button spark effect
const btn = document.querySelector('.cta-v2-actions .cvh-btn-glow');
if (btn) {
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (!prefersReduced) {
        function spawnSpark(e) {
            const spark = document.createElement('span');
            spark.className = 'cta-spark';
            const rect = btn.getBoundingClientRect();
            const x = e.offsetX || rect.width / 2;
            const y = e.offsetY || rect.height / 2;
            spark.style.left = x + 'px';
            spark.style.top = y + 'px';
            btn.appendChild(spark);
            setTimeout(() => spark.remove(), 900);
        }
        btn.addEventListener('pointermove', (ev) => {
            if (Math.random() < 0.15) {
                spawnSpark(ev);
            }
        });
    }
}

// Contact form submission
/*
const contactForm = document.getElementById('contactForm');
const formMessage = document.getElementById('formMessage');

if (contactForm && formMessage) {
    contactForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = {
            name: document.getElementById('v2Name').value,
            email: document.getElementById('v2Email').value,
            subject: document.getElementById('v2Subject').value,
            message: document.getElementById('v2Message').value
        };
        
        try {
            const response = await fetch('/api/contact', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            const result = await response.json();
            
            formMessage.style.display = 'block';
            if (response.ok) {
                formMessage.className = 'alert alert-success';
                formMessage.textContent = result.message || 'Message sent successfully!';
                contactForm.reset();
                if (counter) counter.textContent = '0 / 1200 chars';
            } else {
                formMessage.className = 'alert alert-danger';
                formMessage.textContent = result.error || 'Failed to send message. Please try again.';
            }
        } catch (error) {
            formMessage.style.display = 'block';
            formMessage.className = 'alert alert-danger';
            formMessage.textContent = 'An error occurred. Please try again later.';
        }
    });
}
*/

// Hero Parallax Effect
document.addEventListener('mousemove', (e) => {
    const orbs = document.querySelectorAll('.hero-glow-orb');
    if (orbs.length > 0) {
        const x = e.clientX / window.innerWidth;
        const y = e.clientY / window.innerHeight;
        
        orbs.forEach((orb, index) => {
            const speed = (index + 1) * 20;
            const xOffset = (x - 0.5) * speed;
            const yOffset = (y - 0.5) * speed;
            // Use requestAnimationFrame for smoother performance if needed, 
            // but direct style update is okay for simple effect
            orb.style.transform = `translate(${xOffset}px, ${yOffset}px)`;
        });
    }
});
</script>

<style>
/* Inline tiny style for spark (kept local to CTA) */
.cvh-btn-glow { position:relative; }
.cvh-btn-glow .cta-spark { position:absolute; width:10px; height:10px; pointer-events:none; background:radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0) 70%); border-radius:50%; filter:brightness(1.8) drop-shadow(0 0 4px rgba(0,229,255,0.9)); animation:ctaSpark 0.9s ease-out forwards; }
@keyframes ctaSpark { 0% { transform:translate(-50%, -50%) scale(0.3); opacity:1;} 70% { opacity:1; } 100% { transform:translate(-50%, -50%) scale(1.8); opacity:0;} }
</style>
</Layout>
