---
import Layout from '../layouts/Layout.astro';
import '../styles/faq-modern.css';

interface QA { q: string; a: string; }
interface FAQCategory { key: string; icon: string; label: string; items: QA[] }

// Data model compiled from original Django FAQ (content preserved verbatim)
const faqData: FAQCategory[] = [
  {
    key: 'general', icon: 'fa-info-circle', label: 'General Questions',
    items: [
      { q: 'What is CodeVerseHub?', a: 'CodeVerseHub is a competitive programming platform designed specifically for our Discord community. It provides a comprehensive environment for coding contests, practice problems, skill development, and collaborative learning among programmers of all levels.' },
      { q: 'How do I get started on CodeVerseHub?', a: 'Getting started is easy! Simply create an account using our registration page, join our Discord server, and you can immediately start participating in contests, solving practice problems, and engaging with our community of programmers.' },
      { q: 'Is CodeVerseHub free to use?', a: 'Yes! CodeVerseHub is completely free to use. All features including contests, practice problems, community discussions, and learning resources are available at no cost to all members of our Discord community.' },
      { q: 'What programming languages are supported?', a: 'We support all major programming languages including Python, Java, C++, C, JavaScript, Go, Rust, and many others. You can choose your preferred language for solving problems and participating in contests.' }
    ]
  },
  {
    key: 'account', icon: 'fa-user-circle', label: 'Account & Profile',
    items: [
      { q: 'How do I create an account?', a: 'Click on the "Register" button in the navigation menu, fill out the registration form with your details including your Discord username, and verify your email address. Once registered, you can immediately start using all platform features.' },
      { q: 'Can I change my username later?', a: 'Your username is permanent once created to maintain consistency in leaderboards and contest history. However, you can update your display name, bio, and other profile information at any time through your profile settings.' },
      { q: 'What if I forget my password?', a: 'Use the "Forgot Password" link on the login page to reset your password. You\'ll receive an email with instructions to create a new password. Make sure to check your spam folder if you don\'t see the email immediately.' }
    ]
  },
  {
    key: 'contests', icon: 'fa-trophy', label: 'Contests',
    items: [
      { q: 'How do I participate in contests?', a: 'Browse available contests on the Contests page, click on a contest you\'re interested in, and register before the contest starts. Once registered, you can participate when the contest begins and submit solutions to the problems.' },
      { q: 'What types of contests are available?', a: 'We offer various contest formats including individual competitions, team contests, weekly challenges, themed contests (like algorithms or data structures), and special community events with different difficulty levels.' },
      { q: 'How is scoring calculated in contests?', a: 'Scoring typically considers correctness, time taken to solve problems, and number of submissions. Each contest may have specific scoring rules which are clearly outlined in the contest description before it begins.' }
    ]
  },
  {
    key: 'problems', icon: 'fa-puzzle-piece', label: 'Problems & Solutions',
    items: [
      { q: 'How are problems categorized by difficulty?', a: 'Problems are categorized as Easy, Medium, or Hard based on algorithmic complexity, implementation difficulty, and the concepts required. Beginners should start with Easy problems and gradually progress to more challenging ones.' },
      { q: 'What happens after I submit a solution?', a: 'Your solution is automatically tested against multiple test cases. You\'ll receive immediate feedback including verdict (Accepted, Wrong Answer, Time Limit Exceeded, etc.), execution time, and memory usage.' },
      { q: 'Can I see test cases for problems?', a: 'Each problem includes sample test cases with expected outputs to help you understand the problem. However, your solution will be tested against additional hidden test cases to ensure correctness.' }
    ]
  },
  {
    key: 'technical', icon: 'fa-cog', label: 'Technical Support',
    items: [
      { q: 'What are the time and memory limits for solutions?', a: 'Time and memory limits vary by problem and are clearly specified in each problem statement. Typical limits are 1-2 seconds for time and 256-512 MB for memory, but these can vary based on problem complexity.' },
      { q: 'Why is my code giving a runtime error?', a: 'Runtime errors can occur due to array out of bounds, division by zero, infinite recursion, or other execution issues. Check your code for edge cases, proper input handling, and ensure all variables are properly initialized.' },
      { q: 'What should I do if I encounter a technical issue?', a: 'Report technical issues through our Discord server or contact our moderators. Include details about the problem, your browser/system information, and steps to reproduce the issue for faster resolution.' }
    ]
  },
  {
    key: 'community', icon: 'fa-users', label: 'Community',
    items: [
      { q: 'How can I contribute to CodeVerseHub?', a: 'We welcome contributions! You can contribute by suggesting new problems, writing tutorials, reporting bugs, or helping other members in our Discord community. Active contributors may be invited to join our team.' },
      { q: 'Is there a code of conduct?', a: 'Yes, we maintain a friendly and inclusive environment. All members are expected to follow our community guidelines which prohibit harassment, cheating in contests, and inappropriate behavior. Violations may result in account suspension.' },
      { q: 'How do I contact the administrators?', a: 'You can reach out to administrators and moderators through our Discord server. For specific inquiries, you can also use the contact form on our website or email our support team directly.' }
    ]
  }
];
---

<Layout title="FAQ - CodeVerseHub">
  <div class="faq-page-wrapper">
    <!-- Hero Section -->
    <section class="faq-hero">
      <div class="faq-hero-inner">
        <div class="faq-hero-icon">
          <i class="fas fa-question"></i>
        </div>
        <h1 class="faq-hero-title">Frequently Asked <span class="gradient-text">Questions</span></h1>
        <p class="faq-hero-sub">Everything you need to know about the platform, contests, and community.</p>
        
        <div class="faq-controls">
          <div class="faq-search-wrap">
            <i class="fas fa-search faq-search-icon"></i>
            <input type="text" id="faqSearch" placeholder="Search for answers..." aria-label="Search FAQs">
          </div>
          
          <div class="faq-categories">
            <button class="faq-cat-btn active" data-cat="all" aria-pressed="true">All</button>
            {faqData.map(cat => (
              <button class="faq-cat-btn" data-cat={cat.key} aria-pressed="false">
                {cat.label}
              </button>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ List Section -->
    <section class="faq-section" id="faqList">
      <div class="faq-grid">
        {faqData.map(cat => (
          <>
            <div class="faq-category-heading faq-animate" data-category-heading={cat.key}>
              <i class={`fas ${cat.icon}`}></i> {cat.label}
            </div>
            {cat.items.map(item => (
              <details class="faq-item faq-animate" data-category={cat.key}>
                <summary>
                  <span class="icon"><i class="fas fa-hashtag"></i></span>
                  <span>{item.q}</span>
                  <i class="fas fa-chevron-down caret" aria-hidden="true"></i>
                </summary>
                <div class="faq-answer" set:html={item.a}></div>
              </details>
            ))}
          </>
        ))}
      </div>
    </section>

    <!-- Support CTA -->
    <section class="support-cta">
      <div class="container" style="max-width: 780px; margin: 0 auto;">
        <div class="glass-card p-5 rounded-3xl border border-white/10 bg-white/5 backdrop-blur-md">
          <h2 class="text-3xl font-bold mb-4 text-white"><i class="fas fa-headset mr-3 text-purple-400"></i>Still Need Help?</h2>
          <p class="mb-8 text-gray-400 text-lg">Can’t find what you’re looking for? Reach out — the community & moderators are happy to help you level up.</p>
          <div class="flex flex-wrap justify-center gap-4">
            <a class="btn-modern-primary" href="https://discord.gg/3xKFvKhuGR" target="_blank" rel="noopener">
              <i class="fab fa-discord mr-2"></i>Join Discord
            </a>
            <a class="btn-modern-secondary" href="mailto:support@codeversehub.com">
              <i class="fas fa-envelope mr-2"></i>Email Support
            </a>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Mark JS enabled for CSS fallbacks
    document.body.classList.add('js-enabled');
    const searchInput = document.getElementById('faqSearch') as HTMLInputElement;
    const catButtons = Array.from(document.querySelectorAll('.faq-cat-btn'));
    const faqItems = Array.from(document.querySelectorAll('details.faq-item')) as HTMLDetailsElement[];
    const headings = Array.from(document.querySelectorAll('.faq-category-heading'));

    // Basic reveal (no dependency on IntersectionObserver)
    faqItems.slice(0,20).forEach(i=> i.classList.add('loaded'));

    function filter(cat: string, term: string){
      term = (term||'').toLowerCase();
      faqItems.forEach(it=>{
        const itemCat = it.getAttribute('data-category');
        const matchCat = cat==='all' || itemCat===cat;
        const matchText = !term || (it.textContent || '').toLowerCase().includes(term);
        if(matchCat && matchText){ it.classList.remove('faq-hidden'); }
        else { it.classList.add('faq-hidden'); if(it.hasAttribute('open')) it.removeAttribute('open'); }
      });
      // Toggle headings depending on at least one visible item
      headings.forEach(h=>{
        const key = h.getAttribute('data-category-heading');
        const anyVisible = faqItems.some(it=>!it.classList.contains('faq-hidden') && it.getAttribute('data-category')===key);
        if(anyVisible) h.classList.remove('faq-hidden'); else h.classList.add('faq-hidden');
      });
    }

    catButtons.forEach(btn=>{
      btn.addEventListener('click',()=>{
        catButtons.forEach(b=>{b.classList.remove('active');b.setAttribute('aria-pressed','false');});
        btn.classList.add('active');btn.setAttribute('aria-pressed','true');
        const cat = btn.getAttribute('data-cat') || 'all';
        filter(cat, searchInput?.value);
        // Optional: scroll to list if needed
        // document.getElementById('faqList').scrollIntoView({behavior:'smooth'});
      });
    });

    searchInput?.addEventListener('input',()=>{
      const active = catButtons.find(b=>b.classList.contains('active'));
      const cat = active?.getAttribute('data-cat') || 'all';
      filter(cat, searchInput.value);
    });

    // Initial full show
    filter('all','');
    const first = faqItems.find(i=>!i.classList.contains('faq-hidden'));
    if(first) first.setAttribute('open','');
  </script>
</Layout>
